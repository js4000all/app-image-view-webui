# AGENTS.md（AIエージェント作業ガイド）

このファイルは、AIエージェントがこのリポジトリで**迷わず・安全に・再現可能に**作業するための運用ルールです。

## 1. プロジェクトの目的（最初に読む）

- このアプリは、ローカル画像ディレクトリをブラウザで閲覧するための軽量Web UI。
- 主な価値は「すぐ起動できること」「画像一覧とメイン表示の体験が崩れないこと」。
- 迷ったら、機能追加よりも既存UXの維持を優先する。

## 2. プレビュー確認の定型手順

- 起動コマンド: `python app.py tests/resources/image_root`
- アクセスURL: `http://localhost:8000`
- 初期状態の期待値: サブディレクトリ選択後に画像一覧が表示され、1枚目がメイン表示される
- 失敗時の確認項目: `image_root` のスペル（`-` ではなく `_`）

## 3. 変更前チェック（着手前の基本動作）

1. `README.md` と直近の差分を確認し、今回の変更目的を1〜2文で要約する。
2. 影響範囲（バックエンド / フロント / 静的アセット / ドキュメント）を先に列挙する。
3. 既存挙動をローカルで一度確認してから編集する（比較の基準を作る）。

## 4. 実装時の優先順位

1. 既存挙動の非破壊（回帰を出さない）
2. 変更理由が読める最小差分
3. 命名・構造の一貫性
4. 追加仕様の説明可能性（なぜ必要かを説明できること）

## 5. コンテキスト引き継ぎ（重要）

複数回のやり取りや途中中断を想定し、作業終了時に以下を残す。

- `何を変えたか`: 変更ファイルと要点
- `なぜ変えたか`: 目的・背景・代替案との差分
- `未解決事項`: 残課題、既知の制約、次の一手
- `検証結果`: 実行コマンドと結果（成功 / 失敗理由）

推奨フォーマット（PR本文や最終報告に準拠）:

```md
## Context Handoff
- Goal:
- Changes:
- Decisions:
- Open Questions:
- Verification:
```

## 6. コンテキスト引き継ぎ用ファイルの作成ルール（保存場所の規定）

コンテキスト引き継ぎを目的に、リポジトリ内へ作成してよいファイルは次に限定する。

- ディレクトリ: `docs/agent-handoff/`
- 許可ファイル:
  - `docs/agent-handoff/README.md`（運用ルール・更新手順）
  - `docs/agent-handoff/current.md`（最新の引き継ぎサマリ）
  - `docs/agent-handoff/archive/YYYY-MM-DD-<topic>.md`（履歴）

運用ルール:

1. 一時メモを残す場合も、最終的には `current.md` へ統合し、散在させない。
2. 引き継ぎ本文は「事実・判断・未解決」を分離して記述する。
3. 履歴化する際は `archive/` へ日付付きで移動し、`current.md` は常に最新状態を保つ。
4. 機密情報（鍵、トークン、個人情報、ローカル絶対パス）は記載しない。

禁止事項:

- ルート直下への `memo.md` / `notes.txt` 等のアドホックなメモ追加
- `static/` `tests/` `templates/` 配下への引き継ぎ文書配置
- 意図不明な `tmp*` `draft*` ファイルのコミット

## 7. 設計・仕様の判断ログ（小さくても残す）

仕様や実装方針に判断が入った場合、以下を1〜3行で記録する。

- Decision: 何を採用したか
- Rationale: なぜそれを選んだか
- Impact: どこに影響するか

これにより、後続エージェントが同じ論点を再調査しなくて済む。

## 8. テストと確認観点

- 変更箇所に応じて、最低限以下を確認する。
  - 画面変更あり: ブラウザで表示確認（必要ならスクリーンショット）
  - API/ロジック変更あり: 再現手順と期待値を明文化
  - 文書変更のみ: 記載内容の整合性（コマンド・パス・URL）
- テスト失敗時は「失敗そのもの」よりも「再現条件」と「切り分け状況」を記録する。

## 9. 変更禁止・注意事項

- 無関係なリファクタや大規模整形を同時に行わない。
- 依存追加は、必要性と代替不可理由を説明できる場合のみ。
- 秘密情報・ローカル固有パス・環境依存値をハードコードしない。

## 10. 典型タスク別チェックリスト

### UI変更

- [ ] 一覧表示とメイン画像表示の基本導線が維持されている
- [ ] 初期表示時に1枚目がメイン表示される
- [ ] スタイル崩れが主要画面サイズで発生しない

### 画像読み込み/ディレクトリ処理変更

- [ ] 対象外ファイルの扱いが明確
- [ ] ディレクトリ未存在・空ディレクトリ時の挙動を確認
- [ ] エラーメッセージが利用者に理解可能

## 11. AGENTS.mdに今後追記すると効果が高い項目

運用しながら、次の情報を追加するとエージェント品質が上がる。

- 用語集（このプロジェクト固有の呼称）
- 主要ファイルの責務マップ（どこを触ると何が変わるか）
- 「やってはいけない変更」の具体例
- よくある不具合と一次切り分け手順
- リリース前チェック項目

---

## 補足（このファイルを整備する狙い）

設計や作業コンテキストを引き継ぐ基本動作は、**非常に効果的**です。特に以下の効果があります。

- 調査のやり直し削減（同じ論点の反復防止）
- 判断の一貫性向上（担当が変わっても方針がぶれにくい）
- レビュー効率向上（変更意図の追跡が容易）

そのため、`Context Handoff` と `Decision Log` を最小単位で運用することを推奨します。
